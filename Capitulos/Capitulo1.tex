\chapter{Revisão Bibliográfica}

Neste capítulo, os problemas que deram inspiração para o modelo apresentado neste trabalho serão apresentados. Inicialmente o problema de planejamento \emph{online} para produção de recursos em RTS será exposto. Em seguida, o problema de planejamento de projetos será apresentado. Estes problemas são expostos com seus modelos, e suas aplicações em jogos RTS serão discutidas. Utilizamos estes modelos como referência para a criação de um novo problema mais completo, que consiga preencher as lacunas existentes em cada problema descrito aqui.

\section{Problema de Planejamento \emph{Online} para Produção de Recursos em RTS}
O problema de planejamento \emph{online} para produção de recursos em RTS (PPOPR) possui grande parte das características que são necessárias para a descrição deste tipo de jogo, apesar de incompleto. Este modelo de planejamento de produção foi criado por \citeonline{chan07a}. Ele foi o modelo mais utilizado para o jogo \emph{StarCraft}, e foi utilizado como base para os trabalhos de \citeonline{chan07b}, \citeonline{branq10}, \citeonline{churchill11}, \citeonline{naves12} e \citeonline{captain14}.

\subsection{Modelo}
O problema de planejamento \emph{online} para produção de recursos em jogos RTS foi modelado para ser utilizado por uma inteligência artificial que controla um jogador de RTS. Desta forma, assume-se que o agente jogador está executando as tarefas e manipulando os recursos.

Este problema possui um conjunto de recursos $\hat{R}$ e um conjunto de restrições $\hat{O}$. O estado do jogo em um instante $t$ possui: (a) para cada recurso $\hat{r} \in \hat{R}$, uma quantidade $\hat{q}_r$ que o agente possui e (b) a lista de ações não-concluídas $\hat{T}$, de forma que os tempos de início e fim $\hat{s}_i$ e $\hat{e}_i$ obedeçam à restrição $\hat{s}_i < t < \hat{e}_i$, para toda ação $i \in \hat{T}$. O objetivo consiste em achar uma sequência de ações que cumpra um conjunto de restrições $\hat{O} = \{\hat{q}_1 \geq \hat{m}_1, \dots, \hat{q}_n \geq \hat{m}_n\}$, a partir do estado atual. Isto é, para cada recurso $\hat{r} \in R$, existe um valor mínimo $\hat{m}_r$ que deve ser atingido no estado final. Dentro deste contexto, os componentes principais são os recursos e as ações. Recursos são manipulados pelas ações através de quatro categorias:
\begin{itemize}
  \item \emph{Require}: Um recurso necessário para uma ação ser executada, porém não há aumento ou redução em tal recurso;
  \item \emph{Burrow}: Recurso que é ``trancado'' pela duração da ação, mas é devolvido ao seu término;
  \item \emph{Consume}: Recursos que são removidos ao início da ação;
  \item \emph{Produce}: Recursos que são adicionados ao final da ação.
\end{itemize}

\subsection{Aplicação em jogos RTS}
O modelo foi estendido no trabalho de \citeonline{chan07b} para acomodar análise de meios e fins no planejamento sequencial de ações. O método de análise de meios e fins é um método inicialmente proposto para um \emph{solver} de propósito geral \cite{newell59}, e posteriormente utilizado no planejador STRIPS \cite{fikes71}. A ideia por trás da análise de meios e fins consiste em construir uma sequência de ações cujas produções correspondam a partes da descrição do estado-alvo \cite{mcdermott96}.

No trabalho de \citeonline{branq10}, o modelo foi usado para a criação de um otimizador baseado no algorimo SLA*, que já foi utilizado para resolver problemas de escalonamento de projetos \cite{zamani98}. Este trabalho comparou um planejador que usa SLA* em conjunto com o \emph{MeaPop}, método criado por \citeonline{branq10} para a criação de planejamento parcial, e outros dois planejadores que usaram o método de escalonamento descrito no trabalho de \citeonline{chan07a}, um deles usando o MEA e o outro usando o \emph{MeaPop}.

Um algoritmo \emph{branch and bound} foi criado por \citeonline{churchill11}, e então aplicado em uma inteligência artificial para jogos que participou da competição 2010 AIIDE \emph{StarCraft AI Competition}.

O trabalho apresentado por \citeonline{captain14} possui uma abordagem multiobjetivo para o modelo inicial, procurando otimizar três objetivos na busca por satisfazer um determinado estado-alvo. O otimizador pode não encontrar o estado-alvo, e retornar um estado intermediário, chamado de estado final. As funções objetivo desta abordagem são: (a) minimizar o tempo total de sair do estado inicial para o estado final encontrado pelo algoritmo, (b) minimizar a diferença de recursos entre o estado final e os recursos necessários para se chegar ao estado-alvo, (c) minimizar o tempo necessário para se chegar do estado final ao estado-alvo.

Este modelo apresentado por \citeonline{chan07a}, entretanto, não descreve relações entre os recursos, nem possibilita a existência de eventos cíclicos no sistema, tornando particularmente ruim a modelagem da raça Zerg de \emph{StarCraft}. Para representar a relação entre a estrutura \emph{Hatchery}\footnote{Estrutura base da raça \emph{Zerg}.} e a unidade \emph{Larva} de \emph{StarCraft}, é necessário um modelo que aceite eventos cíclicos, bem como uma dependência inter-recursos, uma vez que não é possível possuir mais que três larvas por \emph{hatchery} e elas são geradas automaticamente a cada sete segundos. A importância das larvas se dá pela maneira como as unidades são produzidas por esta raça: ao invés de necessitar de uma estrutura especializada, os Zerg utilizam larvas para a produção de unidades transformando-as nas unidades desejadas.

Além desta deficiência, o problema de planejamento \emph{online} para produção de recursos em jogos RTS não aceita limites fixos de recursos. Nas séries \emph{StarCraft}, \emph{WarCraft} e \emph{Age of Empires}, o recurso ``suprimento'' é limitado por um valor fixo. No caso de \emph{StarCraft}, este limite é 200, o que significa que por mais que as ações do jogador possam fazê-lo superar este limite, isto não acontece devido às regras do jogo. Portanto, utilizar o modelo descrito anteriormente em situações de meio-jogo ou final de jogo pode se tornar inadequado.

Um outro aspecto em que o modelo de \citeonline{chan07a} possui dificuldade em expressar é quando recursos podem ser tratados como iguais para fins de requisitos. Isto acontece em \emph{StarCraft} quando a estrutura \emph{hatchery} evolui\footnote{A evolução se dá por um processo que transforma uma unidade ou estrutura em outro tipo mais avançado, efetivamente destruindo a unidade antiga e criando uma nova no seu lugar.} para uma \emph{lair} ou esta para uma \emph{hive}. Estruturas que precisam de uma \emph{hatchery} podem ser criadas com uma \emph{lair} ou uma \emph{hive}. De forma similar, as estruturas que precisam de uma \emph{lair} podem ser criadas com uma \emph{hive}. Isto pode ser contornado ao criar tarefas idênticas para cada uma dessas equivalências, porém haveria um grande número de tarefas idênticas dependendo da quantidade de equivalências e das dependências relacionadas.

Esta evolução também não consegue ser expressa nos termos anteriores, pois durante todo o processo de evolução de uma \emph{hatchery}, ela ainda existe e é válida para preencher pré-condições de quaisquer ações. Somente quando a evolução é concluída, a \emph{hatchery} deixa de existir e a \emph{lair} é criada. Assim, um novo tipo de consumo deve existir, que reduza recursos ao final da ação.

Desta forma, este trabalho apresenta um novo modelo para solução de problemas de planejamento em jogos RTS, para modelar aspectos que não foram explorados nos modelos já utilizados.



\section{Problema de Planejamento de Projetos}
Neste trabalho será usada a versão de planejamento de projetos multimodo com restrição de recursos (PPPMRR). Esta versão oferece suporte a uma mesma tarefa que possua diferentes precedências de acordo com o modo em questão. Esta variação de modos é importante em contextos onde uma unidade ou estrutura pode se transformar em outra, como a evolução dos \emph{Zerg}.

\subsection{Modelo}
O modelo do problema de planejamento de projetos multimodo com múltiplos recursos renováveis e não-renováveis \cite{coelho15} pode ser expresso da seguinte forma. Um conjunto de tarefas $\check{V}$, numeradas a partir de uma tarefa postiça inicial 0 até uma tarefa postiça final $\check{T}_f$, deve ser escalonado sem preempção em um conjunto de recursos renováveis $\check{R}$ e um conjunto de recursos não-renováveis $\check{N}$. Cada recurso renovável $k \in \check{R}$ tem uma disponibilidade constante de $\check{R}_k$ unidades, enquanto cada recurso não-renovável $l \in \check{N}$ é restrito em $\check{N}_l$ unidades por todo o horizonte de planejamento. Cada tarefa não-postiça $i \in \check{V}$ pode ser realizada em um de seus $\check{M}_i$ modos, $\check{T}_{im} = \langle \check{d}_{im}, \check{r}_{ikm}, \check{n}_{ilm} \rangle$, onde $m \in \{ 1, \dots, \check{M}_i\}$, $\check{d}_{im}$ é a duração da tarefa, $\check{r}_{ikm}$ é a quantidade requerida de recursos $k \in R$ e $n_{ilm}$ é a quantidade de recursos $l \in \check{N}$ consumidos. A rede de dependências do projeto é representada por um grafo dirigido $\check{G} = (\check{V},\check{E})$, em que os vértices, $i \in \check{V}$, representam as tarefas e as arestas, $(i,j) \in \check{E}$, representam as relações de precedência em que a tarefa $j$ deve começar, no mínimo, no tempo em que a tarefa $i$ terminar. Isto significa que deve haver um tempo de atraso maior ou igual a zero entre o início de uma tarefa e o fim de todas as tarefas que a precedem. Assume-se que esta rede seja acíclica. As tarefas postiças 0 e $\check{T}_f$ representam o início e o fim do projeto, e possuem duração e requisitos de todos os recursos iguais a zero. Um agendamento $S$ é definido por um vetor de tempos iniciais de tarefas, e é dito viável se todas as restrições de precedência e restrições de recursos renováveis e não-renováveis forem satisfeitas. O objetivo deste tipo de problema é encontrar um agendamento viável com o menor tempo de conclusão possível ($C_{max}$ ou \emph{makespan}).

Assim, o problema é representado como $(m, 1T|cpm,disc,mu|C_{max})$ usando a classificação de \citeonline{herroelen99}, onde $m$ indica que o problema possui uma quantidade $m$ de recursos; $1T$ indica que estes recursos podem ser tanto renováveis quanto não-renováveis; $cpm$ indica que as tarefas estão sujeitas a restrições rigorosas de precedência sem nenhum atraso, como usado no método de caminho crítico; $disc$ indica que os requisitos das tarefas são uma função discreta da duração da tarefa; $mu$ indica que as tarefas possuem múltiplos modos de execução; e $C_{max}$ indica que a função objetivo é minimizar o \emph{makespan}.

O PPPMRR também pode ser representado como $(MPS | prec | C_{max})$ usando a classificação de \citeonline{brucker99}, onde $MPS$ indica que o problema de planejamento de projeto é multimodo; $prec$ indica a existência de precedência entre tarefas; e $C_{max}$ indica que a função objetivo é minimizar o \emph{makespan}.

A formulação do PPPMRR é descrita nas equações 2.1--2.6.
\begin{equation}
  \text{minimizar } C_{max}
\end{equation}
\[
  \text{sujeito a}
\]
\begin{flalign}
  &\sum^{\check{M}_i}_{m=1} \sum^{LS_i}_{t=ES_i} (t + \check{d}_{im}) \check{x}_{imt} \leq \sum^{\check{M}_j}_{m=1} \sum^{LS_j}_{t=ES_j} t \check{x}_{jmt}, \forall (i,j) \in E\\
  &\sum^{\check{M}_i}_{m=1} \sum^{LS_i}_{t=ES_i} \check{x}_{imt} = 1, \forall i \in V\\
  &\sum_{i \in V} \sum^{\check{M}_i}_{m=1} \sum^{LS_i}_{t=ES_i} n_{ikm} \check{x}_{ims} \leq N_k, \forall k \in N\\
  &\sum_{i \in V} \sum^{\check{M}_i}_{m=1} \sum^{t+\check{d}_{im}-1}_{s=t} r_{ikm} \check{x}_{ims} \leq R_k, \forall k \in R, \forall t \in \{1, \dots, UB\}\\
  &\check{x}_{imt} \in \{0,1\}, \forall i \in V, m \in \{1, \dots, M\}, t \in \{1, \dots, UB\}
\end{flalign}

Na formulação apresentada, $\check{x}_{imt}$ é igual a 1 se a atividade $i$ for realizada no modo $m$ e inicializada no tempo $t$, ou igual a zero nos outros casos. A primeira equação (2.1) mostra a função objetivo, que é minimizar o tempo de conclusão da última tarefa. A restrição 2.2 garante que as tarefas cumpram as relações de precedência com nenhum tempo de atraso. A restrição 2.3 garante que cada tarefa seja executada exatamente uma vez em apenas um modo. A restrição 2.5 restringe os recursos não-renováveis por todo horizonte de tempo. As restrições sobre recursos renováveis são satisfeitas pela restrição 2.4, onde $UB$ é o horizonte de projeto ou o limite superior para o seu tempo de conclusão. As variáveis de decisão tem seus limitem em 2.6. Os valores $ES_i$ e $LS_i$ denotam o tempo mais cedo e mais tardio de início da tarefa $i$, usando os cálculos de caminho crítico tradicionais.

\subsection{Aplicação em jogos RTS}
O modelo do PPPMRR pode ser utilizado para aproximar o tempo de conclusão de um conjunto de tarefas num cenário de jogos RTS. Neste contexto, os recursos de um jogo podem ser as construções, unidades militares e trabalhadores, além de tecnologias. Por exemplo, para produzir um \emph{marine}\footnote{Unidade militar básica da raça Terran.}, é necessário usar, e portanto possuir, uma estrutura especializada (\emph{barracks}), que por sua vez precisa de recursos brutos (minérios) e trabalhadores para ser construída.

Como o problema de planjeamento de projetos possui diferentes variações, a versão escolhida, multimodo com restrição de recursos, é a que mais se adequa ao contexto deste gênero de jogos. Para RTS, o problema deve ser não-preemptivo com restrição de recursos, além de ter recursos renováveis e não-renováveis. Isto quer dizer que as tarefas (e.g. ações de produção de unidades) não podem ser pausadas e concluídas futuramente, por ser não-preemptivo. A restrição de recursos se dá pela natureza limitada dos recursos do jogo. Trabalhadores são recursos renováveis que possuem uma quantidade limitada. Já minérios são recursos não-renováveis, que também possuem uma quantidade limitada e que se reduz a cada ação de produção.

Entretanto, a natureza rígida das restrições de recursos, bem como a necessidade de concluir todas as tarefas do projeto tornam o trabalho de modelar um jogo pouco recompensador. As restrições de recursos não permitem que a aquisição de recursos ao longo do jogo seja levada em conta durante os cálculos, como a produção de novas unidades ou coleta de recursos por trabalhadores. Já as restrições de precedência dão trabalho adicional ao modelador das instâncias. Embora os tipos de recursos do jogo não mudem nem suas dependências, é necessário ter um novo grafo de precedência para cada conjunto de tarefas que se queira fazer em um determinado momento do jogo.

O problema de planejamento de projetos contribuiu para os trabalhos envolvendo jogos de estratégia em tempo real com o método SLA*, que foi utilizado para problemas de escalonamento de projetos por \citeonline{zamani98}. \citeonline{branq10} utilizaram este método para solucionar uma extensão do problema de planejamento \emph{online} para produção de recursos em RTS. No próximo capítulo, o novo problema de produção será abordado. Este modelo procura resolver as restrições que o problema de planejamento de projeto impõe aos recursos e à precedência de tarefas, incorporando conceitos do problema de planejamento \emph{online} para produção de recursos em RTS.
